(function(n){if(typeof define!="undefined"&&define.amd)define(["jquery"],n);else if(typeof module!="undefined"&&module.exports){var t=require("jquery");module.exports=n(t)}else window.scrollMonitor=n(jQuery)})(function(n){function tt(){return window.innerHeight||document.documentElement.clientHeight}function f(){if(t.viewportTop=a.scrollTop(),t.viewportBottom=t.viewportTop+t.viewportHeight,t.documentHeight=ft.height(),t.documentHeight!==nt){for(y=i.length;y--;)i[y].recalculateLocation();nt=t.documentHeight}}function et(){t.viewportHeight=tt();f();p()}function ot(){clearTimeout(it);it=setTimeout(et,100)}function p(){for(u=i.length;u--;)i[u].update();for(u=i.length;u--;)i[u].triggerCallbacks()}function w(i,u){function f(n){if(n.length!==0)for(b=n.length;b--;)nt=n[b],nt.callback.call(tt,v),nt.isOne&&n.splice(b,1)}var tt=this,y,it,l,a,p,w,b,nt;for(this.watchItem=i,this.offsets=u?u===+u?{top:u,bottom:u}:n.extend({},g,u):g,this.callbacks={},y=0,it=r.length;y<it;y++)tt.callbacks[r[y]]=[];this.locked=!1;this.triggerCallbacks=function(){this.isInViewport&&!l&&f(this.callbacks[o]);this.isFullyInViewport&&!a&&f(this.callbacks[s]);this.isAboveViewport!==p&&this.isBelowViewport!==w&&(f(this.callbacks[e]),a||this.isFullyInViewport||(f(this.callbacks[s]),f(this.callbacks[c])),l||this.isInViewport||(f(this.callbacks[o]),f(this.callbacks[h])));!this.isFullyInViewport&&a&&f(this.callbacks[c]);!this.isInViewport&&l&&f(this.callbacks[h]);this.isInViewport!==l&&f(this.callbacks[e]);switch(!0){case l!==this.isInViewport:case a!==this.isFullyInViewport:case p!==this.isAboveViewport:case w!==this.isBelowViewport:f(this.callbacks[d])}l=this.isInViewport;a=this.isFullyInViewport;p=this.isAboveViewport;w=this.isBelowViewport};this.recalculateLocation=function(){var r,u,i,e;this.locked||(r=this.top,u=this.bottom,this.watchItem.nodeName?(i=this.watchItem.style.display,i==="none"&&(this.watchItem.style.display=""),e=n(this.watchItem).offset(),this.top=e.top,this.bottom=e.top+this.watchItem.offsetHeight,i==="none"&&(this.watchItem.style.display=i)):this.watchItem===+this.watchItem?this.top=this.watchItem>0?this.bottom=this.watchItem:this.bottom=t.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom),this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,(r!==undefined||u!==undefined)&&(this.top!==r||this.bottom!==u)&&f(this.callbacks[k]))};this.recalculateLocation();this.update();l=this.isInViewport;a=this.isFullyInViewport;p=this.isAboveViewport;w=this.isBelowViewport}function st(n){v=n;f();p()}var t={},a=n(window),ft=n(document),i=[],e="visibilityChange",o="enterViewport",s="fullyEnterViewport",h="exitViewport",c="partiallyExitViewport",k="locationChange",d="stateChange",r=[e,o,s,h,c,k,d],g={top:0,bottom:0},nt,v,y,it,u,rt,l,ut,b;for(t.viewportTop,t.viewportBottom,t.documentHeight,t.viewportHeight=tt(),w.prototype={on:function(n,t,i){switch(!0){case n===e&&!this.isInViewport&&this.isAboveViewport:case n===o&&this.isInViewport:case n===s&&this.isFullyInViewport:case n===h&&this.isAboveViewport&&!this.isInViewport:case n===c&&this.isAboveViewport:if(t(),i)return}if(this.callbacks[n])this.callbacks[n].push({callback:t,isOne:i});else throw new Error("Tried to add a scroll monitor listener of type "+n+". Your options are: "+r.join(", "));},off:function(n,t){if(this.callbacks[n]){for(var i=0,u;u=this.callbacks[n][i];i++)if(u.callback===t){this.callbacks[n].splice(i,1);break}}else throw new Error("Tried to remove a scroll monitor listener of type "+n+". Your options are: "+r.join(", "));},one:function(n,t){this.on(n,t,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<t.viewportTop;this.isBelowViewport=this.bottom>t.viewportBottom;this.isInViewport=this.top<=t.viewportBottom&&this.bottom>=t.viewportTop;this.isFullyInViewport=this.top>=t.viewportTop&&this.bottom<=t.viewportBottom||this.isAboveViewport&&this.isBelowViewport},destroy:function(){var u=i.indexOf(this),f=this,n,t;for(i.splice(u,1),n=0,t=r.length;n<t;n++)f.callbacks[r[n]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}},rt=function(n){return function(t,i){this.on.call(this,n,t,i)}},l=0,ut=r.length;l<ut;l++)b=r[l],w.prototype[b]=rt(b);try{f()}catch(ht){n(f)}a.on("scroll",st);a.on("resize",ot);return t.beget=t.create=function(t,r){typeof t=="string"&&(t=n(t)[0]);t instanceof n&&(t=t[0]);var u=new w(t,r);return i.push(u),u.update(),u},t.update=function(){v=null;f();p()},t.recalculateLocations=function(){t.documentHeight=0;t.update()},t});